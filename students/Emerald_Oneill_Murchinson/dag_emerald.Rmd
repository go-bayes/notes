---
title: "Internalising and Externalising in Parents and Offspring: The Impact of Sex and Early Life Adversity"
description: |
author:
  - name: Joseph Bulbulia
    url: https://josephbulbulia.netlify.app
    affiliation: Victoria University of Wellington
    affiliation_url: https://www.wgtn.ac.nz
    orcid_id: 0000-0002-5861-2056
date: June 2, 2021
output:
  distill::distill_article:
    self_contained: true
    toc: false
    code_folding: true
    highlight: tango
    highlight_downlit: false
bibliography: references.bib
---

```{r setup, include = FALSE}
# set up
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  echo = TRUE
)
```

```{r message = FALSE}
# required packages
if (!require(ggdag)) install.packages("ggdag")
```

## A causal graph

Graphing this assumed model, we find a structure like this:

```{r  layout="l-body-outset",  fig.height=8, fig.width=12}
# Graph model
library(ggdag)
dg_1<- ggdag::dagify(
  outcome ~   sex + ela + mat_ex + mat_in + pat_ex + pat_in,
  ela ~   sex + mat_ex + mat_in + pat_ex + pat_in, 
  exposure = "ela",
  outcome = "outcome"#,
  # labels = c(
  #   "depress_2" = "depression t2",
  #   "depress_1" = "depression t1",
  #   "sr_1" = "self reflection t1",
  #   "sr_2" = "self reflection t2",
  #   "male" = "male",
  #   "age" = "age",
  #   "event_2" = "life events t2",
  #   "event_1" = "life events t1",
  #   "em_1" = "episodic memory t1",
  #   "em_2" = "episodic memory t1",
  #   "rumination_1" = "rumination t1",
  #   "rumination_2" = "rumination t2"
  #  )
) #%>%
  #control_for("sex")
# p1 <-ggdag(dg_1, text = FALSE, use_labels = "label") +

p1 <-ggdag(dg_1) +theme_dag_blank() + labs(title = "Proposed Model")
p1
```

## Causal inference

1.  It is important to close all \`back doors'

2.  It is *equally* important introduce any collider confounds open. This latter point is under-appreciated, however see: [@rohrer2018, @mcelreath2020, @pearl2019]. Note that [@rohrer2018] is very accessible.

3.  We should not block any paths between episodic memory at time 1 and depression at time 2.

The following are the potential adjustment sets that enable unbiased inference conditional on our model assumptions:

```{r adjustsetDirect, layout="l-body-outset",  fig.height=8, fig.width=12}
# find adjustment set
p2 <-ggdag::ggdag_adjustment_set(
  dg_1,
  exposure = "ela",
  outcome = "outcome" #,
  # text = FALSE,
  # use_labels  = "label"
) +
  theme_dag_blank() +
  labs(title = "Adjustment set",
  subtite = "")
p2
```

Surprisingly, the model is robust to genetic influences that might affect the outcomes. 


```{r}
dg_u <- ggdag::dagify(
  outcome ~   sex + ela + mat_ex + mat_in + pat_ex + pat_in + U,
  ela ~   sex + mat_ex + mat_in + pat_ex + pat_in, 
  pat_ex ~ U, 
  pat_in ~ U, 
  mat_ex ~ U,
  mat_in ~ U, 
  exposure = "ela",
  outcome = "outcome"#,
  # labels = c(
  #   "depress_2" = "depression t2",
  #   "depress_1" = "depression t1",
  #   "sr_1" = "self reflection t1",
  #   "sr_2" = "self reflection t2",
  #   "male" = "male",
  #   "age" = "age",
  #   "event_2" = "life events t2",
  #   "event_1" = "life events t1",
  #   "em_1" = "episodic memory t1",
  #   "em_2" = "episodic memory t1",
  #   "rumination_1" = "rumination t1",
  #   "rumination_2" = "rumination t2"
  #  )
) #%>%
  #control_for("sex")
# p1 <-ggdag(dg_1, text = FALSE, use_labels = "label") +

p2 <-ggdag(dg_u) +theme_dag_blank() + labs(title = "Proposed Model")
p2


```


## Packages used

```{r echo = FALSE}
report::cite_packages()
```
